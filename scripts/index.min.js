let scale=1,currentScreen="loaderScreen";const animationScreenEnd={};let animationNextStop=!1,animationStop=!1,bottleStartOffset,boxBadgeStartOffsetTop,boxBadgeStartOffsetLeft,laptopTextInterval=[];const preloaderVideos={vp9:{type:"video/webm",codec:"vp9",src:"/media/video/preloader_vp9.webm"},vp8:{type:"video/webm",codec:"vp8",src:"/media/video/preloader_vp8.webm"},hvc1:{type:"video/quicktime",codec:"hvc1",src:"/media/video/preloader_hevc.mov"}},quizData={clothes:[{type:"MULTI_CHOICE",question:"Какая одежда необходима?",choices:["Футболки","Поло","Жилеты","Куртка (ветровка)","Худи (толстовка)","Фартук","Нужно нанесение принта на готовое изделие"],other:"Свой вариант"},{type:"INPUT",question:"Какое количество необходимо?",placeholder:"Укажите общее количество (минимальный тираж 30 шт.)"},{type:"CHOICE",question:"Нужно ли нанесение логотипа (принта)?",choices:["Нужно, есть макет","Нужно, нет макета","Не нужно"]}],office:[{type:"MULTI_CHOICE",question:"Какие аксессуары необходимы?",choices:["Бейдж с лентой","Внешний аккумулятор / powerbank","Ежедневник","Ручка","Термостакан / бутылка для воды","Стикерпак с локальными мемами","Шоппер","Беспроводные наушники","Бейсболка","Футболка с принтом"],other:"Свой вариант"},{type:"INPUT",question:"Какое количество необходимо?",placeholder:"Укажите общее количество (минимальный тираж 30 шт.)"},{type:"CHOICE",question:"Нужно ли нанесение логотипа (принта)?",choices:["Нужно, есть макет","Нужно, нет макета","Не нужно"]}],gift:[{type:"MULTI_CHOICE",question:"Какие позиции необходимы?",choices:["Внешний аккумулятор / powerbank","Термостакан / бутылка для воды","Вместительная сумка-шоппер","Рюкзак","Плед / декоративная подушка","Зонт","Футболка","Худи"],other:"Свой вариант"},{type:"INPUT",question:"Какое количество необходимо?",placeholder:"Укажите общее количество (минимальный тираж 30 шт.)"},{type:"CHOICE",question:"Нужно ли нанесение логотипа (принта)?",choices:["Нужно, есть макет","Нужно, нет макета","Не нужно"]}]},productsData={id:{type:"product",title:"Хочу выделяться\nво время конференции",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать аксессуары для конференции?",video:"/media/video/conference",quizTitle:"Аксессуары для конференции",quizKey:"office"},gift:{type:"product",title:"Хочу подарки\nна праздники",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать подарки на праздники?",video:"/media/video/gift",quizTitle:"Подарки на праздники",quizKey:"gift"},bag:{type:"product",title:"Хочу мерч\nдля продажи",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать мерч для продажи?",video:"/media/video/merch",quizTitle:"Мерч для продажи",quizKey:"gift"},tShirt:{type:"product",title:"Хочу одежду\nсо своим брендигом",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать одежду со своим брендингом?",video:"/media/video/branding",quizTitle:"Одежда с брендингом",quizKey:"clothes"},apron:{type:"product",title:"Хочу одеть\nсвоих сотрудников",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать одежду для своих сотрудников?",video:"/media/video/corp",quizTitle:"Одежда для сотрудников",quizKey:"clothes"},cup:{type:"product",title:"Хочу аксессуары\nдля офиса",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать аксессуары для офиса?",video:"/media/video/office",quizTitle:"Аксессуары для офиса",quizKey:"office"},bottle:{type:"product",title:"Хочу сувениры\nдля спорта и отдыха",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать сувениры для спорта и отдыха?",video:"/media/video/souvenir",quizTitle:"Сувениры для спорта и отдыха",quizKey:"gift"},welcome:{type:"product",title:"Хочу welcome-pack\nдля сотрудников",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать welcome-pack для своих сотрудников?",video:"/media/video/welcome",quizTitle:"Welcome-pack",quizKey:"office"},laptop:{type:"service",title:"Хотите заказать такую же\nпромо страницу?",text:'У вас есть продукт, который нужно эффектно представить потенциальной аудитории? Хотите видеть на вашей странице подобную анимацию? Тогда отправляйте свой запрос нам на почту <a href="mailto:info@topline.ru">info@topline.ru</a> и в ближайшее время наш менеджер свяжется с вами.',shortText:"Хотите заказать такую же промо страницу?"}},getDisplayedEl=e=>{for(let t of e){let l=getComputedStyle(t);if("none"!==l.display)return t}},getAttr=(e,t,l)=>{let n=getDisplayedEl(e);if(n){let o=n.dataset[t];return isNaN(+o)?"true"===o||"false"!==o&&n.dataset[t]:+o}return l},moveToTop=()=>{let e=document.querySelectorAll(".modal.open");for(let t of e)t.classList.remove("open"),t.classList.contains("product")&&closeFullVideoOrQuiz(!1),zIndex-=1,t.style.zIndex="";for(let l of document.querySelectorAll(".contentWrapper"))l.style.zIndex="",l.style.top="",l.style.opacity="";dispatchAnimationEnd("firstScreen",!1,0,()=>{moveTo(0),rollbackAnimation()}),animationStop=!1},resizeContent=()=>{bottleStartOffset=void 0,boxBadgeStartOffsetTop=void 0,boxBadgeStartOffsetLeft=void 0;let e=document.getElementById("hiddenContent"),{body:t}=document;scale=Math.min(t.offsetWidth/e.offsetWidth,t.offsetHeight/e.offsetHeight);let l=document.getElementsByClassName("headerWrapper");for(let n of l)for(let o of(n.style.transform=`scaleY(${scale})`,n.children))o.style.transform=`scaleX(${scale})`,o.style.opacity="1";let a=document.getElementsByClassName("content");for(let s of a)s.style.transform=`scale(${scale})`,s.style.opacity="1";let i=document.getElementById("menuModalButtons");i.style.transform=`scale(${scale})`,i.firstElementChild.style.width=`${100/scale}%`;let r=document.getElementById("productNavigator");r.style.width=`${100/scale}%`,r.style.transform=`scale(${scale})`;let c=document.getElementsByClassName("menuHintContent");for(let d of c)d.style.transform=`scale(${scale})`,d.style.opacity="1"},animateFirstScreen=({currentY:e,deltaY:t})=>{let l=document.querySelector("#firstScreen .content"),n=l.parentElement||l.parentNode,o=document.getElementById("layer2"),a=l.offsetHeight*scale,s=Math.floor((n.offsetHeight-a)/scale);if(animationScreenEnd.firstScreen=n.offsetHeight,e>0){if(e<n.offsetHeight){let i=1-(n.offsetHeight-e)/n.offsetHeight;o.style.top=`-${i*(l.offsetHeight+s)}px`}else o.style.top=`-${l.offsetHeight+s}px`,dispatchAnimationEnd("secondScreen",!1)}else 0===e&&t<0&&(o.style.top="0px")},animateSecondScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.firstScreen,n=document.querySelector("#secondScreen .content"),o=n.parentElement||n.parentNode,a=document.getElementById("secondText"),s=document.getElementById("clothesImages"),i=document.querySelector("#secondScreen .eye"),r=n.offsetWidth*scale,c=Math.floor((o.offsetWidth-r)/2/scale),d=n.offsetWidth+c;if(animationScreenEnd.secondScreen=animationScreenEnd.firstScreen+4*o.offsetHeight,t<0&&l<=0)o.style.opacity="0",a.style.top="100%",dispatchAnimationEnd("firstScreen",!0,300),s.style.opacity="0",s.style.zIndex="-1";else if(l<o.offsetHeight){let p=(o.offsetHeight-l)/o.offsetHeight;s.style.opacity="1",s.style.zIndex="2",s.style.left=`${d}px`,a.style.top=`${n.offsetHeight*p}px`}else if(l<2*o.offsetHeight){a.style.top="0px";let y=(2*o.offsetHeight-l)/o.offsetHeight,f=getAttr(n.getElementsByClassName("tShirt"),"stop",0),m=Math.round((d-f)*y+f);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${m}px`,i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="-1",i.style.opacity="0"}else if(l<2.5*o.offsetHeight){let u=getAttr(n.getElementsByClassName("tShirt"),"stop",0);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${u}px`,i.style.transition="opacity 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="3",i.style.opacity="1",i.dataset.product="tShirt"}else if(l<3*o.offsetHeight){i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.opacity="0",i.style.zIndex="-1";let h=(3*o.offsetHeight-l)/(o.offsetHeight/2),g=getAttr(n.getElementsByClassName("tShirt"),"stop",0),$=getAttr(n.getElementsByClassName("apron"),"stop",0),E=Math.round((g-$)*h+$);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${E}px`}else if(l<3.5*o.offsetHeight){let S=getAttr(n.getElementsByClassName("apron"),"stop",0);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${S}px`,i.style.transition="opacity 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="3",i.style.opacity="1",i.dataset.product="apron"}else if(l<4*o.offsetHeight){i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="-1",i.style.opacity="0";let x=getAttr(n.getElementsByClassName("apron"),"stop",0),v=1-(4*o.offsetHeight-l)/(o.offsetHeight/2);s.style.opacity="1",s.style.zIndex="2",s.style.left=`calc(${x-c*v}px - ${100*v}%)`}else e>=animationScreenEnd.secondScreen&&(i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.opacity="0",i.style.zIndex="-1",a.style.top="0",dispatchAnimationEnd("cupScreen",!1))},animateCupScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.secondScreen,n=document.querySelector("#cupScreen .content"),o=n.parentElement||n.parentNode,a=document.getElementById("cup"),s=document.getElementById("cupText"),i=document.querySelector("#cupScreen .eye"),r=n.offsetWidth*scale,c=n.offsetHeight*scale,d=Math.floor((o.offsetWidth-r)/2/scale),p=Math.floor((o.offsetHeight-c)/2/scale);(!a.style.top||t>0&&a.style.top===`calc(100% + ${p}px)`)&&(a.style.top=`calc(100% + ${p}px)`,a.style.opacity="1",a.style.transition="top 0.5s",a.style.top=`calc((100% - ${a.offsetHeight}px) / 2)`,a.style.transition="top 0.5s, opacity 0.3s"),s.style.top||(s.style.left=`calc(100% + ${d}px)`,s.style.opacity="1");let y=n.offsetWidth+s.offsetWidth+2*d;if(animationScreenEnd.cupScreen=animationScreenEnd.secondScreen+y,l<=0)i.style.opacity="0",a.style.opacity="1",a.style.transform="rotate(0deg)",t<0?(a.style.top=`calc(100% + ${p}px)`,dispatchAnimationEnd("secondScreen",!0)):a.style.top=`calc((100% - ${a.offsetHeight}px) / 2)`,s.style.left=`calc(100% + ${d}px)`;else if(e>=animationScreenEnd.cupScreen)i.style.opacity="0",a.style.opacity="0",a.style.transform="rotate(360deg)",s.style.left=`calc(100% + ${d}px - ${animationScreenEnd.cupScreen}px)`,dispatchAnimationEnd("bottleScreen",!1,500);else{l>=y/3&&l<.95*y?i.style.opacity="1":i.style.opacity="0",a.style.opacity="1";let f=l/y*360;a.style.transform=`rotate(${-f}deg)`,s.style.left=`calc(100% + ${d}px - ${l}px)`}},animateBottleScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.cupScreen,n=document.querySelector("#bottleScreen .content"),o=n.parentElement||n.parentNode,a=document.getElementsByClassName("bottle"),s=getDisplayedEl(a),i=getAttr(a,"rotate",!0),r=getAttr(a,"stop",!0),c=document.getElementById("bottleText"),d=document.querySelector("#bottleScreen .eye"),p=n.offsetHeight*scale,y=Math.floor((o.offsetHeight-p)/2/scale),f=n.offsetHeight+2*y;if(animationScreenEnd.bottleScreen=animationScreenEnd.cupScreen+2.5*f,void 0===bottleStartOffset&&(bottleStartOffset=s.offsetTop),t<0&&l<=0)d.style.opacity="0",s.style.top="",c.style.opacity="0",dispatchAnimationEnd("cupScreen",!0);else if(l<f){d.style.opacity="0";let m=l/f;if(i){c.style.opacity="0",s.style.top=`calc(${50*m}% - ${s.offsetHeight/2*m}px + ${bottleStartOffset*(1-m)}px)`;let u=90*m;s.style.transform=`rotate(${u}deg)`}else l>.3*f?c.style.opacity="1":c.style.opacity="0",s.style.top=`calc(${bottleStartOffset*(1-m)}px + ${r*m}px - ${s.offsetHeight*m}px)`}else if(l<2*f){if(c.style.opacity="1",i){d.style.opacity="0";let h=(l-f)/f;s.style.transform="rotate(90deg)";let g=`(50% - ${s.offsetHeight/2}px)`;s.style.top=`calc(${g} - (50% * ${h}))`}else d.style.opacity="1",s.style.top=`${r-s.offsetHeight}px`}else e<animationScreenEnd.bottleScreen?(d.style.opacity="1",i?s.style.top=`calc(-${s.offsetHeight/2}px)`:s.style.top=`${r-s.offsetHeight}px`):(i?s.style.top=`calc(-${s.offsetHeight/2}px)`:s.style.top=`${r-s.offsetHeight}px`,dispatchAnimationEnd("boxScreen",!1))},animateBoxScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.bottleScreen,n=document.querySelector("#boxScreen .content"),o=n.parentElement||n.parentNode,a=document.getElementById("box"),s=document.getElementById("boxCover"),i=document.getElementById("boxBadge"),r=document.querySelector("#boxScreen .eye"),c=n.offsetHeight*scale,d=Math.floor((o.offsetHeight-c)/2/scale),p=n.offsetHeight+2*d;if(animationScreenEnd.boxScreen=animationScreenEnd.bottleScreen+5.3*p,void 0===boxBadgeStartOffsetTop&&(boxBadgeStartOffsetTop=i.offsetTop),void 0===boxBadgeStartOffsetLeft&&(boxBadgeStartOffsetLeft=i.offsetLeft),t<0&&(a.style.opacity="1"),t<0&&l<=0)a.style.transform="scale(0)",r.style.opacity="0",r.style.zIndex="-1",dispatchAnimationEnd("bottleScreen",!0);else if(l<p){r.style.opacity="0",r.style.zIndex="-1";let y=l/p;a.style.transform=`scale(${y})`,s.style.top="0px"}else if(l<2*p){l<1.8*p?(r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product=""):(r.style.opacity="1",r.style.zIndex="3",r.className="eye modalOpen tShirtEye",r.dataset.product="welcome"),a.style.transform="scale(1)";let f=(l-p)/p,m=s.offsetHeight-25,u=m*f;s.style.top=`${u}px`}else if(l<2.3*p){r.style.opacity="1",r.style.zIndex="3",r.className="eye modalOpen tShirtEye",r.dataset.product="welcome";let h=s.offsetHeight-25;s.style.top=`${h}px`,i.style.transform="",i.style.top="",i.style.left="",i.style.zIndex=""}else if(l<2.8*p){let g=(2.8*p-l)*2/p;r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product="",i.style.transform=`scale(${1+3.2*(1-g)}) rotate(${39*(1-g)-46*g}deg)`,i.style.top=`${boxBadgeStartOffsetTop*g+(a.offsetHeight-i.offsetHeight)/2*(1-g)}px`,i.style.left=`${boxBadgeStartOffsetLeft*g+(a.offsetWidth-i.offsetWidth)/2*(1-g)}px`,i.style.zIndex="2"}else if(l<3.8*p)r.style.opacity="1",r.style.zIndex="3",r.className="eye modalOpen boxBadgeEye",r.dataset.product="id",i.style.transform="scale(4.2) rotate(39deg)",i.style.top=`${(a.offsetHeight-i.offsetHeight)/2}px`,i.style.left=`${(a.offsetWidth-i.offsetWidth)/2}px`,i.style.zIndex="2";else if(l<4.3*p){r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product="";let $=(4.3*p-l)*2/p;i.style.transform=`scale(${1+3.2*$}) rotate(${39*$-46*(1-$)}deg)`,i.style.top=`${boxBadgeStartOffsetTop*(1-$)+(a.offsetHeight-i.offsetHeight)/2*$}px`,i.style.left=`${boxBadgeStartOffsetLeft*(1-$)+(a.offsetWidth-i.offsetWidth)/2*$}px`,i.style.zIndex="2"}else if(e<animationScreenEnd.boxScreen){r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product="",i.style.transform="",i.style.top="",i.style.left="",i.style.zIndex="";let E=(l-4.3*p)/p,S=s.offsetHeight-25,x=S-S*E;s.style.top=`${x}px`}else r.style.opacity="0",r.style.zIndex="-1",s.style.top="0px",a.style.opacity="0",dispatchAnimationEnd("laptopScreen",!1,500)},animateLaptopScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.boxScreen,n=document.querySelector("#laptopScreen .content"),o=document.querySelector("#footer .content"),a=n.parentElement||n.parentNode,s=document.querySelector("#laptopScreen .eye"),i=o.offsetHeight*scale;if(animationScreenEnd.laptopScreen=animationScreenEnd.boxScreen+i,t<0&&e<=animationScreenEnd.boxScreen){s.style.opacity="0",laptopTextInterval.length&&(laptopTextInterval.forEach(clearInterval),laptopTextInterval=[]);let r=document.getElementById("laptopText");r.innerText="",dispatchAnimationEnd("boxScreen",!0)}else e<=animationScreenEnd.laptopScreen?a.style.top=`-${l}px`:(a.style.top=`-${i}px`,animationNextStop=!0)},animate=({detail:e={}})=>{switch(currentScreen){case"firstScreen":animateFirstScreen(e);break;case"secondScreen":animateSecondScreen(e);break;case"cupScreen":animateCupScreen(e);break;case"bottleScreen":animateBottleScreen(e);break;case"boxScreen":animateBoxScreen(e);break;case"laptopScreen":animateLaptopScreen(e)}},rollbackAnimation=()=>{let e={currentY:0,deltaY:-1};animateFirstScreen(e),animateSecondScreen(e),animateCupScreen(e),animateBottleScreen(e),animateBoxScreen(e),animateLaptopScreen(e)},defaultActivateScreen=(e,t,l)=>{let n=document.getElementById("footer");if(n.style.zIndex="-1",animationNextStop=!0,t){let o=document.getElementById(e),a=o.nextElementSibling;if(a){if(!l){let s=e=>{e.target===a&&(o.style.zIndex="2",a.style.zIndex="",animationNextStop=!1,a.removeEventListener("transitionend",s))};a.addEventListener("transitionend",s)}a.style.top="100%"}}else{let i=document.getElementById(e);if(i){l||i.addEventListener("transitionend",e=>{e.target===i&&(animationNextStop=!1)});let r=i.previousElementSibling;r.classList.contains("contentWrapper")&&(r.style.zIndex="1"),i.style.top="0",i.style.opacity="1",i.style.zIndex="2"}}},activateLaptopScreen=()=>{let e=document.getElementById("laptopScreen"),t=document.getElementById("footer"),l=document.querySelector("#laptopScreen .eye"),n=document.getElementById("laptopText"),o=n.dataset.text;e.style.zIndex="3",t.style.zIndex="2",t.style.opacity="1",l.style.opacity="0";let a=0,s=e=>{n.innerText=o.substring(0,e)};laptopTextInterval.push(setInterval(()=>{s(a),a>=o.length&&(laptopTextInterval.forEach(clearInterval),laptopTextInterval=[],l.style.opacity="1",e.style.animation="1s linear 0s prevFooter",animationNextStop=!1),a+=1},100))},changeCurrentScreen=e=>{let{nextScreen:t,prev:l,delay:n,callback:o}=e.detail;n&&(animationStop=!0),setTimeout(()=>{switch(animationStop=!1,t){case"firstScreen":defaultActivateScreen(t,l),animationNextStop=!1;break;case"secondScreen":case"cupScreen":case"bottleScreen":case"boxScreen":defaultActivateScreen(t,l);break;case"laptopScreen":defaultActivateScreen(t,l,!0),activateLaptopScreen()}currentScreen=t,o&&o()},n)},moveTo=e=>{let t=new CustomEvent("moveTo",{detail:{moveTo:e}});window.dispatchEvent(t)},getStopPseudoScroll=e=>!!animationStop||(e<0&&(animationNextStop=!1),animationNextStop),startMainFlow=()=>{let e=document.getElementById("preloader"),t=document.querySelector("#preloader .content"),l=t.parentElement||t.parentNode,n=document.getElementById("preloaderRound"),o=document.getElementById("preloaderButton"),a=Math.max(l.offsetHeight,l.offsetWidth),s=a/scale*2;dispatchAnimationEnd("firstScreen",!1),n.style.height=`${s}px`,n.style.width=`${s}px`;let i=window.innerWidth/window.innerHeight<.75,r=1.33>window.innerWidth/window.innerHeight>=.75;if(i?(o.style.bottom="20px",o.style.height="40px",o.style.width="280px"):r?(o.style.bottom="32px",o.style.height="64px",o.style.width="343px"):(o.style.bottom="90px",o.style.height="64px",o.style.width="343px"),e.style.opacity="0.1",e.addEventListener("transitionend",()=>{e.classList.remove("open")}),window.localStorage.hintClosed)setTimeout(()=>{for(let e of document.querySelectorAll("#firstScreen .eye"))e.classList.add("active")},1e3);else{animationStop=!0;let c=document.getElementById("modalHint");zIndex+=1,c.style.zIndex=zIndex.toString(),c.classList.add("open")}};let videoStarted=!1;const preloaderActivate=({target:e})=>{if(!videoStarted){videoStarted=!0;let{duration:t}=e,l=document.querySelector("#preloader .content"),n=l.parentElement||l.parentNode,o=document.getElementById("preloaderText"),a=l.offsetWidth*scale,s=Math.floor((n.offsetWidth-a)/2/scale);o.style.left=`calc(100% + ${s}px)`,o.style.transition=`left ${t}s`,o.style.left=`-${o.offsetWidth+s}px`,o.style.opacity="1"}},preloaderVideoEnd=()=>{let e=document.getElementById("preloader"),t=document.getElementById("preloaderButton");t.addEventListener("click",startMainFlow),e.classList.add("videoEnd")},videoSample=e=>{e.target.currentTime>2&&(e.target.currentTime=0)},closeModal=e=>{let{target:t}=e,l=0;for(;!t.classList.contains("modalClose")&&l<10;)t=t.parentElement||t.parentNode,l+=1;let n=document.querySelectorAll(".modalOpen.hideOnClick"),{modal:o}=t.dataset,a=document.getElementById(o);for(let s of n)s.dataset.modal===o&&(s.style.opacity="");a&&(a.classList.remove("open"),a.classList.remove("inactiveVideoOrQuiz"),zIndex-=1,a.style.zIndex="",animationStop=!1)},closeFullVideoOrQuiz=(e=!0)=>{let t=document.getElementById("productBlock"),l=document.getElementById("modalProduct"),n=document.getElementById("backButton"),o=document.getElementById("playButton"),a=document.querySelector("#modalProduct video"),s=document.getElementById("infoBlock"),i=document.getElementById("quizBlock");o.style.display="",setTimeout(()=>{s.style.display="",i.style.display=""},200),setTimeout(()=>{t.style.height=""},1200),n.removeEventListener("click",closeFullVideoOrQuiz),n.addEventListener("click",closeModal),l.classList.remove("activeVideo"),l.classList.remove("activeQuiz"),e&&l.classList.add("inactiveVideoOrQuiz"),a&&a.addEventListener("timeupdate",videoSample)},playFullVideo=()=>{let e=document.getElementById("modalProduct"),t=document.getElementById("backButton"),l=document.getElementById("playButton");l.style.display="none",t.removeEventListener("click",closeModal),t.addEventListener("click",closeFullVideoOrQuiz),e.classList.remove("inactiveVideoOrQuiz"),e.classList.add("activeVideo")},fullScreenChange=e=>{let t=document.fullscreenElement;!t&&document.mozFullScreenElement?t=document.mozFullScreenElement:!t&&document.webkitFullscreenElement&&(t=document.webkitFullscreenElement);let l=document.querySelector("#modalProduct video");e.target===t?(l.removeEventListener("timeupdate",videoSample),e.target.classList.add("mobileHorizontal")):(l.addEventListener("timeupdate",videoSample),e.target.classList.remove("mobileHorizontal"))},fullScreenVideo=()=>{let e=document.querySelector("#modalProduct video");e.playsInline=void 0,e.removeEventListener("timeupdate",videoSample),e.requestFullscreen?e.requestFullscreen():e.webkitEnterFullscreen?e.webkitEnterFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},setQuizStep=e=>()=>{let t=document.getElementById("quizQuestion"),l=t.innerText-1;if(Number.isInteger(e))t.innerText=e+1;else{let n=document.getElementById("quizTitle");n.innerText="Оставьте свои контакты и имя";let o=document.getElementById("quizCounter");o.style.display="none"}let a=document.getElementById("question_"+l);a.classList.remove("active");let s=document.getElementById("question_"+e);s.classList.add("active")},submitQuiz=e=>{e.preventDefault();let t=document.getElementById("quiz"),l=new window.FormData(t),n=l.get("quizKey"),o=quizData[n],a=l.get("quizName"),s=Array.from(l.keys()).filter((e,t,l)=>l.indexOf(e)===t);o.forEach((e,t)=>{a+="\n"+e.question,s.forEach(e=>{e.includes("question_"+t)&&(a+="\n"+l.getAll(e).join("\n"))})});let i={_url:window.location.href,"your-name":l.get("name"),"your-phone":l.get("phone"),"your-email":l.get("mail"),"your-message":a};fetch("http://new.topline.gq/n8n/webhook/promo_orders",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(i)}).then(()=>{let e=document.getElementById("quizTitle");e.innerText="Уже видим Ваш запрос!";let l=document.querySelectorAll("#quizBlock .question.active");l.forEach(e=>{e.classList.remove("active")});let n=document.createElement("h2");n.className="message",n.innerText="Вернемся с расчетом бюджета и сроков в самое ближайшее время",t.append(n)})},checkAnswer=(e,t)=>()=>{let l=document.getElementById("quiz"),n=Array.from(new window.FormData(l).entries()),o=n.find(([t,l])=>t.includes("question_"+e)&&l);t.disabled=!o},checkContact=e=>()=>{let t=document.getElementById("quiz"),l=new window.FormData(t),n=l.get("phone"),o=n.length>=16,a=l.get("mail"),s=/[^@]+@[^@]+\.[^@.]+/.test(a);e.disabled=!(l.get("name")&&(o||s))},startQuiz=e=>()=>{let t=document.getElementById("modalProduct"),l=document.getElementById("productBlock"),n=document.getElementById("backButton"),o=document.getElementById("infoBlock"),a=document.getElementById("quizBlock"),s=document.getElementById("quiz");s.addEventListener("submit",e=>e.preventDefault()),s.innerHTML="";let i=quizData[e.quizKey],r=document.createElement("div");r.className="quizHeader";let c=document.createElement("h1");c.className="quizTitle",c.id="quizTitle",c.innerText=e.quizTitle,r.append(c);let d=document.createElement("div");d.className="quizCounter",d.id="quizCounter";let p=document.createElement("span");p.innerText="1",p.id="quizQuestion",d.append(p);let y=document.createElement("span");y.innerText=i.length.toString(),d.append(y),r.append(d),s.append(r);let f=document.createElement("input");f.name="quizKey",f.type="hidden",f.value=e.quizKey,s.append(f);let m=document.createElement("input");m.name="quizName",m.type="hidden",m.value=e.quizTitle,s.append(m),i.forEach((e,t)=>{let l=document.createElement("div");t?l.className="question":l.className="question active",l.id="question_"+t;let n=document.createElement("h2");n.innerText=e.question,l.append(n);let o=document.createElement("button");if("MULTI_CHOICE"===e.type){let a=document.createElement("i");a.innerText="(можно выбрать несколько вариантов)",n.append(a);let r=document.createElement("fieldset");e.choices.forEach(e=>{let l=document.createElement("label");l.className="checkbox";let n=document.createElement("input");n.type="checkbox",n.name="question_"+t+"_choice",n.value=e,n.addEventListener("change",checkAnswer(t,o)),l.append(n);let a=document.createElement("span");a.innerText=e,l.append(a),r.append(l)}),l.append(r)}if("CHOICE"===e.type){let c=document.createElement("fieldset");e.choices.forEach(e=>{let l=document.createElement("label");l.className="radio";let n=document.createElement("input");n.type="radio",n.name="question_"+t+"_choice",n.value=e,n.addEventListener("change",checkAnswer(t,o)),l.append(n);let a=document.createElement("span");a.innerText=e,l.append(a),c.append(l)}),l.append(c)}if("INPUT"===e.type){let d=document.createElement("textarea");d.name="question_"+t+"_text",d.placeholder=e.placeholder,d.addEventListener("input",checkAnswer(t,o)),l.append(d)}if(e.other){let p=document.createElement("textarea");p.name="question_"+t+"_text",p.placeholder=e.other,p.addEventListener("input",checkAnswer(t,o)),l.append(p)}let y=document.createElement("div");if(y.className="buttons",t){let f=document.createElement("button");f.className="button border blue",f.innerHTML="<span>Назад</span>",f.addEventListener("click",setQuizStep(t-1)),y.append(f)}o.className="button blue",o.disabled=!0,t<i.length-1?(o.innerHTML="<span>Дальше</span>",o.addEventListener("click",setQuizStep(t+1))):(o.innerHTML="<span>Оформить</span>",o.addEventListener("click",setQuizStep("contact"))),y.append(o),l.append(y),s.append(l)});{let u=document.createElement("button"),h=document.createElement("div");h.className="question",h.id="question_contact";let g=document.createElement("input");g.name="name",g.placeholder="Имя",g.addEventListener("input",checkContact(u)),h.append(g);let $=document.createElement("input");$.type="phone",$.name="phone",$.placeholder="+7 (",IMask($,{mask:"+{7}(000)000-00-00"}),$.addEventListener("input",checkContact(u)),h.append($);let E=document.createElement("input");E.name="mail",E.placeholder="test@test.com",E.addEventListener("input",checkContact(u)),h.append(E),u.className="submit button blue",u.innerHTML="<span>Отправить</span>",u.disabled=!0,u.addEventListener("click",submitQuiz),h.append(u),s.append(h)}l.style.height=`${l.offsetHeight}px`,n.removeEventListener("click",closeModal),n.addEventListener("click",closeFullVideoOrQuiz),setTimeout(()=>{t.classList.remove("inactiveVideoOrQuiz"),t.classList.add("activeQuiz")},10),setTimeout(()=>{o.style.display="none",a.style.display="flex"},1e3)},activateProduct=(e,t=!0)=>{let l=document.getElementById("modalProduct");l.classList.remove("activeVideo");let n=e.charAt(0).toUpperCase()+e.slice(1),o="product"+n,a="navigator"+n,s=document.getElementById(o),i=s.parentElement||s.parentNode;for(let r of i.children)if(r!==s&&r.classList.contains("active")){if(t){let c=[{top:"unset",left:"unset",bottom:0,right:0,opacity:1,transform:"none"},{top:"unset",left:"unset",bottom:"-50%",right:"-100%",opacity:0,transform:"rotate(32deg)"},{top:"unset",left:"unset",bottom:"-50%",right:"-100%",opacity:0,transform:"rotate(32deg)"}],d={duration:800,iterations:1};r.animate(c,d)}r.classList.remove("active")}s.classList.add("active");let p=document.getElementById(a),y=p.parentElement||p.parentNode;for(let f of y.children)f!==p&&f.classList.remove("active");p.classList.add("active"),y.scrollTo(p.offsetLeft-y.offsetWidth/2,0);let m=productsData[e],u=document.getElementById("productTitle");u.innerHTML=m.title;let h=document.getElementById("productText");h.innerHTML=m.text;let g=document.getElementById("productShortText");g.innerHTML=m.shortText;let $=document.getElementById("quizButton"),E=document.getElementById("mailButton"),S=document.getElementById("productVideo"),x=document.getElementById("playButton"),v=document.getElementById("playButtonMobile"),_=document.getElementById("downloadButton"),I=document.getElementById("downloadButtonMobile"),z=S.getElementsByTagName("video");for(;z.length;)z.item(0).remove();if("service"===m.type)$.style.display="none",E.style.display="flex",x.style.display="none",v.style.display="none",_.style.display="flex",I.style.display="flex",S.classList.add("empty"),S.style.height="",S.style.width="";else if("product"===m.type){E.style.display="none",$.style.display="flex",_.style.display="none",I.style.display="none",x.style.display="flex",v.style.display="flex",S.classList.remove("empty");let B=document.createElement("video");B.addEventListener("timeupdate",videoSample),B.requestFullscreen?B.addEventListener("fullscreenchange",fullScreenChange):B.mozRequestFullScreen?B.addEventListener("mozfullscreenchange",fullScreenChange):B.webkitRequestFullScreen&&B.addEventListener("webkitfullscreenchange",fullScreenChange),B.autoplay=!0,B.loop=!0,B.playsInline=!0;let b=document.createElement("source");b.src=m.video+".webm",b.type="video/webm",B.append(b);let L=document.createElement("source");L.src=m.video+".mp4",L.type="video/mp4",B.append(L),S.insertBefore(B,S.firstChild),x.addEventListener("click",playFullVideo),v.addEventListener("click",fullScreenVideo),$.addEventListener("click",startQuiz(m))}};let zIndex=1e4;const addEvents=()=>{window.addEventListener("resize",resizeContent),window.addEventListener("pseudoScroll",animate),window.addEventListener("animationEnd",changeCurrentScreen);let e=document.querySelector("#preloader video");e.addEventListener("play",preloaderActivate),e.addEventListener("timeupdate",preloaderActivate),e.addEventListener("ended",preloaderVideoEnd);let t=document.getElementsByClassName("modalOpen"),l=document.getElementsByClassName("modalClose");for(let n of t){let{classList:o,dataset:a}=n,{modal:s}=a;o.contains("eye")?(n.addEventListener("transitionend",e=>{if("width"===e.propertyName){let{target:t}=e;if("1"===e.target.dataset.click){e.target.dataset.click="";let l=0;for(;!t.classList.contains("modalOpen")&&l<10;)t=t.parentElement||t.parentNode,l+=1;if(t===n){let{product:o}=a,i=document.getElementById(s);i.classList.add("open"),zIndex+=1,i.style.zIndex=zIndex.toString(),activateProduct(o,!1),t.style.top=t.dataset.top,t.style.left=t.dataset.left,t.style.height=t.dataset.height,t.style.width=t.dataset.width,t.style.fontSize=t.dataset.fontSize,t.style.transition=t.dataset.transition,t.style.zIndex=t.dataset.zIndex,animationStop=!0}}}}),n.addEventListener("click",e=>{let{target:t}=e,l=0;for(;!t.classList.contains("modalOpen")&&l<10;)t=t.parentElement||t.parentNode,l+=1;let n=t;for(l=0;!n.classList.contains("content")&&l<100;)n=n.parentElement||n.parentNode,l+=1;document.getElementById("hiddenContent");let o=Math.max(window.innerHeight,window.innerWidth),a=t.offsetHeight/t.offsetWidth,s,i;a>1?(i=15*o,s=15*o/a):(i=15*o*a,s=15*o);let r=i/t.offsetHeight;t.dataset.click="1",t.dataset.transition=t.style.transition,t.style.transition="font-size cubic-bezier(.4,0,1,.44) 1.5s, width cubic-bezier(.4,0,1,.44) 1.5s, height cubic-bezier(.4,0,1,.44) 1.5s, top cubic-bezier(.4,0,1,.44) 1.5s, left cubic-bezier(.4,0,1,.44) 1.5s",t.dataset.top=t.style.top,t.style.top="50%",t.dataset.left=t.style.left,t.style.left="50%",t.dataset.height=t.style.height,t.style.height=`${i}px`,t.dataset.width=t.style.width,t.style.width=`${s}px`,t.dataset.fontSize=t.style.fontSize,t.style.fontSize=`${10*r}px`,t.dataset.zIndex=t.style.zIndex,zIndex+=1,t.style.zIndex=zIndex})):n.addEventListener("click",e=>{let{target:t}=e,l=0;for(;!t.classList.contains("modalOpen")&&l<10;)t=t.parentElement||t.parentNode,l+=1;let n=document.getElementById(s),o=n.classList.contains("open");n.classList.add("open"),zIndex+=1,n.style.zIndex=zIndex.toString(),a.product&&activateProduct(a.product,o),t.classList.contains("hideOnClick")&&(t.style.opacity="0"),animationStop=!0})}for(let i of l)i.addEventListener("click",closeModal);let r=document.getElementsByClassName("changeProduct");for(let c of r){let{dataset:d}=c,{product:p}=d;c.addEventListener("click",()=>{activateProduct(p),animationStop=!0})}let y=document.getElementsByClassName("navButton"),f=document.getElementById("menuNavigator"),m=f.parentElement||f.parentNode,u=m.parentElement||m.parentNode;for(let h of y){let{type:g}=h.dataset,$=document.querySelector(`.menuHintContentWrapper.${g} .menuHintContent`),E=$.parentElement||$.parentNode;h.addEventListener("mouseover",()=>{let e=m.offsetWidth*scale,t=Math.floor((u.offsetWidth-e)/2),l=(m.offsetWidth-f.offsetWidth)*scale,n=t+l;for(let o of(n<$.offsetWidth&&($.style.minWidth=`${t+l}px`,$.style.maxWidth=`${t+l}px`),E.style.transition="left 0.3s 0.2s",E.style.left=`calc(100% - ${n}px)`,y))o!==h&&(o.style.opacity="0.3")}),h.addEventListener("mouseout",()=>{for(let e of($.style.minWidth="",$.style.maxWidth="",E.style.transition="left 0.3s",E.style.left="100%",y))e!==h&&(e.style.opacity="")})}},closeHint=()=>{animationStop=!1;let e=document.getElementById("modalHint");e.classList.remove("open"),zIndex-=1,e.style.zIndex="",setTimeout(()=>{for(let e of document.querySelectorAll("#firstScreen .eye"))e.classList.add("active")},1e3),window.localStorage.hintClosed=!0},setPreloaderVideo=()=>{let e=["iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,t=void 0!==window.safari,l=document.getElementById("preloader"),n=document.getElementById("preloaderVideo"),o;t||e?(o=preloaderVideos.hvc1.src,l.style.background="#FFFFFF",l.style.color="#7382EC"):o=n.canPlayType&&n.canPlayType(`${preloaderVideos.vp9.type}; codecs=${preloaderVideos.vp9.codec}`)?preloaderVideos.vp9.src:preloaderVideos.vp8.src,n.src=o,n.oncanplay=()=>{n.play()}};window.onload=()=>{animationStop=!0,registerPseudoScrollEvent(window,getStopPseudoScroll),resizeContent(),addEvents(),setPreloaderVideo()};