let scale=1,currentScreen="loaderScreen";const animationScreenEnd={};let animationNextStop=!1,animationStop=!1,bottleStartOffset,boxBadgeStartOffsetTop,boxBadgeStartOffsetLeft,laptopTextInterval=[];const preloaderVideos={vp9:{type:"video/webm",codec:"vp9",src:"/media/video/preloader_vp9.webm"},vp8:{type:"video/webm",codec:"vp8",src:"/media/video/preloader_vp8.webm"},hvc1:{type:"video/quicktime",codec:"hvc1",src:"/media/video/preloader_hevc.mov"}},quizData={clothes:[{type:"MULTI_CHOICE",question:"Какая одежда необходима?",choices:["Футболки","Поло","Жилеты","Куртка (ветровка)","Худи (толстовка)","Фартук","Нужно нанесение принта на готовое изделие"],other:"Свой вариант"},{type:"INPUT",question:"Какое количество необходимо?",placeholder:"Укажите общее количество (минимальный тираж 30 шт.)"},{type:"CHOICE",question:"Нужно ли нанесение логотипа (принта)?",choices:["Нужно, есть макет","Нужно, нет макета","Не нужно"]}],office:[{type:"MULTI_CHOICE",question:"Какие аксессуары необходимы?",choices:["Бейдж с лентой","Внешний аккумулятор / powerbank","Ежедневник","Ручка","Термостакан / бутылка для воды","Стикерпак с локальными мемами","Шоппер","Беспроводные наушники","Бейсболка","Футболка с принтом"],other:"Свой вариант"},{type:"INPUT",question:"Какое количество необходимо?",placeholder:"Укажите общее количество (минимальный тираж 30 шт.)"},{type:"CHOICE",question:"Нужно ли нанесение логотипа (принта)?",choices:["Нужно, есть макет","Нужно, нет макета","Не нужно"]}],gift:[{type:"MULTI_CHOICE",question:"Какие позиции необходимы?",choices:["Внешний аккумулятор / powerbank","Термостакан / бутылка для воды","Вместительная сумка-шоппер","Рюкзак","Плед / декоративная подушка","Зонт","Футболка","Худи"],other:"Свой вариант"},{type:"INPUT",question:"Какое количество необходимо?",placeholder:"Укажите общее количество (минимальный тираж 30 шт.)"},{type:"CHOICE",question:"Нужно ли нанесение логотипа (принта)?",choices:["Нужно, есть макет","Нужно, нет макета","Не нужно"]}]},productsData={id:{type:"product",title:"Хочу выделяться\nво время конференции",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать аксессуары для конференции?",video:"/media/video/conference",quizTitle:"Аксессуары для конференции",quizKey:"office"},gift:{type:"product",title:"Хочу подарки\nна праздники",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать подарки на праздники?",video:"/media/video/gift",quizTitle:"Подарки на праздники",quizKey:"gift"},bag:{type:"product",title:"Хочу мерч\nдля продажи",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать мерч для продажи?",video:"/media/video/merch",quizTitle:"Мерч для продажи",quizKey:"gift"},tShirt:{type:"product",title:"Хочу одежду\nсо своим брендигом",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать одежду со своим брендингом?",video:"/media/video/branding",quizTitle:"Одежда с брендингом",quizKey:"clothes"},apron:{type:"product",title:"Хочу одеть\nсвоих сотрудников",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать одежду для своих сотрудников?",video:"/media/video/corp",quizTitle:"Одежда для сотрудников",quizKey:"clothes"},cup:{type:"product",title:"Хочу аксессуары\nдля офиса",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать аксессуары для офиса?",video:"/media/video/office",quizTitle:"Аксессуары для офиса",quizKey:"office"},bottle:{type:"product",title:"Хочу сувениры\nдля спорта и отдыха",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать сувениры для спорта и отдыха?",video:"/media/video/souvenir",quizTitle:"Сувениры для спорта и отдыха",quizKey:"gift"},welcome:{type:"product",title:"Хочу welcome-pack\nдля сотрудников",text:"Хотите заказать одежду со свои логотипом или фирменным стилем? Пройдите небольшую анкенту для того, чтобы мы могли подготовить для вас наилучшее предложение.",shortText:"Хотите заказать welcome-pack для своих сотрудников?",video:"/media/video/welcome",quizTitle:"Welcome-pack",quizKey:"office"},laptop:{type:"service",title:"Хотите заказать такую же\nпромо страницу?",text:'У вас есть продукт, который нужно эффектно представить потенциальной аудитории? Хотите видеть на вашей странице подобную анимацию? Тогда отправляйте свой запрос нам на почту <a href="mailto:info@topline.ru">info@topline.ru</a> и в ближайшее время наш менеджер свяжется с вами.',shortText:"Хотите заказать такую же промо страницу?"}},getDisplayedEl=e=>{for(let t of e){let l=getComputedStyle(t);if("none"!==l.display)return t}},getAttr=(e,t,l)=>{let n=getDisplayedEl(e);if(n){let a=n.dataset[t];return isNaN(+a)?"true"===a||"false"!==a&&n.dataset[t]:+a}return l},moveToTop=()=>{let e=document.querySelectorAll(".modal.open");for(let t of e)t.classList.remove("open"),t.classList.contains("product")&&closeFullVideoOrQuiz(!1),zIndex-=1,t.style.zIndex="";for(let l of document.querySelectorAll(".contentWrapper"))l.style.zIndex="",l.style.top="",l.style.opacity="";dispatchAnimationEnd("firstScreen",!1,0,()=>{moveTo(0),rollbackAnimation()}),animationStop=!1},resizeContent=()=>{bottleStartOffset=void 0,boxBadgeStartOffsetTop=void 0,boxBadgeStartOffsetLeft=void 0;let e=document.getElementById("hiddenContent"),{body:t}=document;scale=Math.min(t.offsetWidth/e.offsetWidth,t.offsetHeight/e.offsetHeight);let l=document.getElementsByClassName("headerWrapper");for(let n of l)for(let a of(n.style.transform=`scaleY(${scale})`,n.children))a.style.transform=`scaleX(${scale})`,a.style.opacity="1";let o=document.getElementsByClassName("content");for(let s of o)s.style.transform=`scale(${scale})`,s.style.opacity="1";let i=document.getElementById("menuModalButtons");i.style.transform=`scale(${scale})`,i.firstElementChild.style.width=`${100/scale}%`;let r=document.getElementById("productNavigator");r.style.width=`${100/scale}%`,r.style.transform=`scale(${scale})`;let c=document.getElementsByClassName("menuHintContent");for(let d of c)d.style.transform=`scale(${scale})`,d.style.opacity="1"},animateFirstScreen=({currentY:e,deltaY:t})=>{let l=document.querySelector("#firstScreen .content"),n=l.parentElement||l.parentNode,a=document.getElementById("layer2"),o=l.offsetHeight*scale,s=Math.floor((n.offsetHeight-o)/scale);if(animationScreenEnd.firstScreen=n.offsetHeight,e>0){if(e<n.offsetHeight){let i=1-(n.offsetHeight-e)/n.offsetHeight;a.style.top=`-${i*(l.offsetHeight+s)}px`}else a.style.top=`-${l.offsetHeight+s}px`,dispatchAnimationEnd("secondScreen",!1)}else 0===e&&t<0&&(a.style.top="0px")},animateSecondScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.firstScreen,n=document.querySelector("#secondScreen .content"),a=n.parentElement||n.parentNode,o=document.getElementById("secondText"),s=document.getElementById("clothesImages"),i=document.querySelector("#secondScreen .eye"),r=n.offsetWidth*scale,c=Math.floor((a.offsetWidth-r)/2/scale),d=n.offsetWidth+c;if(animationScreenEnd.secondScreen=animationScreenEnd.firstScreen+4*a.offsetHeight,t<0&&l<=0)a.style.opacity="0",o.style.top="100%",dispatchAnimationEnd("firstScreen",!0,300),s.style.opacity="0",s.style.zIndex="-1";else if(l<a.offsetHeight){let p=(a.offsetHeight-l)/a.offsetHeight;s.style.opacity="1",s.style.zIndex="2",s.style.left=`${d}px`,o.style.top=`${n.offsetHeight*p}px`}else if(l<2*a.offsetHeight){o.style.top="0px";let y=(2*a.offsetHeight-l)/a.offsetHeight,f=getAttr(n.getElementsByClassName("tShirt"),"stop",0),m=Math.round((d-f)*y+f);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${m}px`,i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="-1",i.style.opacity="0"}else if(l<2.5*a.offsetHeight){let u=getAttr(n.getElementsByClassName("tShirt"),"stop",0);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${u}px`,i.style.transition="opacity 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="3",i.style.opacity="1",i.dataset.product="tShirt"}else if(l<3*a.offsetHeight){i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.opacity="0",i.style.zIndex="-1";let h=(3*a.offsetHeight-l)/(a.offsetHeight/2),g=getAttr(n.getElementsByClassName("tShirt"),"stop",0),E=getAttr(n.getElementsByClassName("apron"),"stop",0),S=Math.round((g-E)*h+E);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${S}px`}else if(l<3.5*a.offsetHeight){let $=getAttr(n.getElementsByClassName("apron"),"stop",0);s.style.opacity="1",s.style.zIndex="2",s.style.left=`${$}px`,i.style.transition="opacity 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="3",i.style.opacity="1",i.dataset.product="apron"}else if(l<4*a.offsetHeight){i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.zIndex="-1",i.style.opacity="0";let x=getAttr(n.getElementsByClassName("apron"),"stop",0),v=1-(4*a.offsetHeight-l)/(a.offsetHeight/2);s.style.opacity="1",s.style.zIndex="2",s.style.left=`calc(${x-c*v}px - ${100*v}%)`}else e>=animationScreenEnd.secondScreen&&(i.style.transition="opacity 0.3s, z-index 0s 0.3s, width 0.3s, height 0.3s, font-size 0.3s",i.style.opacity="0",i.style.zIndex="-1",o.style.top="0",dispatchAnimationEnd("cupScreen",!1))},animateCupScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.secondScreen,n=document.querySelector("#cupScreen .content"),a=n.parentElement||n.parentNode,o=document.getElementById("cup"),s=document.getElementById("cupText"),i=document.querySelector("#cupScreen .eye"),r=n.offsetWidth*scale,c=n.offsetHeight*scale,d=Math.floor((a.offsetWidth-r)/2/scale),p=Math.floor((a.offsetHeight-c)/2/scale);(!o.style.top||t>0&&o.style.top===`calc(100% + ${p}px)`)&&(o.style.top=`calc(100% + ${p}px)`,o.style.opacity="1",o.style.transition="top 0.5s",o.style.top=`calc((100% - ${o.offsetHeight}px) / 2)`,o.style.transition="top 0.5s, opacity 0.3s"),s.style.top||(s.style.left=`calc(100% + ${d}px)`,s.style.opacity="1");let y=n.offsetWidth+s.offsetWidth+2*d;if(animationScreenEnd.cupScreen=animationScreenEnd.secondScreen+y,l<=0)i.style.opacity="0",o.style.opacity="1",o.style.transform="rotate(0deg)",t<0?(o.style.top=`calc(100% + ${p}px)`,dispatchAnimationEnd("secondScreen",!0)):o.style.top=`calc((100% - ${o.offsetHeight}px) / 2)`,s.style.left=`calc(100% + ${d}px)`;else if(e>=animationScreenEnd.cupScreen)i.style.opacity="0",o.style.opacity="0",o.style.transform="rotate(360deg)",s.style.left=`calc(100% + ${d}px - ${animationScreenEnd.cupScreen}px)`,dispatchAnimationEnd("bottleScreen",!1,500);else{l>=y/3&&l<.95*y?i.style.opacity="1":i.style.opacity="0",o.style.opacity="1";let f=l/y*360;o.style.transform=`rotate(${-f}deg)`,s.style.left=`calc(100% + ${d}px - ${l}px)`}},animateBottleScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.cupScreen,n=document.querySelector("#bottleScreen .content"),a=n.parentElement||n.parentNode,o=document.getElementsByClassName("bottle"),s=getDisplayedEl(o),i=getAttr(o,"rotate",!0),r=getAttr(o,"stop",!0),c=document.getElementById("bottleText"),d=document.querySelector("#bottleScreen .eye"),p=n.offsetHeight*scale,y=Math.floor((a.offsetHeight-p)/2/scale),f=n.offsetHeight+2*y;if(animationScreenEnd.bottleScreen=animationScreenEnd.cupScreen+2.5*f,void 0===bottleStartOffset&&(bottleStartOffset=s.offsetTop),t<0&&l<=0)d.style.opacity="0",s.style.top="",c.style.opacity="0",dispatchAnimationEnd("cupScreen",!0);else if(l<f){d.style.opacity="0";let m=l/f;if(i){c.style.opacity="0",s.style.top=`calc(${50*m}% - ${s.offsetHeight/2*m}px + ${bottleStartOffset*(1-m)}px)`;let u=90*m;s.style.transform=`rotate(${u}deg)`}else l>.3*f?c.style.opacity="1":c.style.opacity="0",s.style.top=`calc(${bottleStartOffset*(1-m)}px + ${r*m}px - ${s.offsetHeight*m}px)`}else if(l<2*f){if(c.style.opacity="1",i){d.style.opacity="0";let h=(l-f)/f;s.style.transform="rotate(90deg)";let g=`(50% - ${s.offsetHeight/2}px)`;s.style.top=`calc(${g} - (50% * ${h}))`}else d.style.opacity="1",s.style.top=`${r-s.offsetHeight}px`}else e<animationScreenEnd.bottleScreen?(d.style.opacity="1",i?s.style.top=`calc(-${s.offsetHeight/2}px)`:s.style.top=`${r-s.offsetHeight}px`):(i?s.style.top=`calc(-${s.offsetHeight/2}px)`:s.style.top=`${r-s.offsetHeight}px`,dispatchAnimationEnd("boxScreen",!1))},animateBoxScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.bottleScreen,n=document.querySelector("#boxScreen .content"),a=n.parentElement||n.parentNode,o=document.getElementById("box"),s=document.getElementById("boxCover"),i=document.getElementById("boxBadge"),r=document.querySelector("#boxScreen .eye"),c=n.offsetHeight*scale,d=Math.floor((a.offsetHeight-c)/2/scale),p=n.offsetHeight+2*d;if(animationScreenEnd.boxScreen=animationScreenEnd.bottleScreen+5.3*p,void 0===boxBadgeStartOffsetTop&&(boxBadgeStartOffsetTop=i.offsetTop),void 0===boxBadgeStartOffsetLeft&&(boxBadgeStartOffsetLeft=i.offsetLeft),t<0&&(o.style.opacity="1"),t<0&&l<=0)o.style.transform="scale(0)",r.style.opacity="0",r.style.zIndex="-1",dispatchAnimationEnd("bottleScreen",!0);else if(l<p){r.style.opacity="0",r.style.zIndex="-1";let y=l/p;o.style.transform=`scale(${y})`,s.style.top="0px"}else if(l<2*p){l<1.8*p?(r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product=""):(r.style.opacity="1",r.style.zIndex="3",r.className="eye modalOpen tShirtEye",r.dataset.product="welcome"),o.style.transform="scale(1)";let f=(l-p)/p,m=s.offsetHeight-25,u=m*f;s.style.top=`${u}px`}else if(l<2.3*p){r.style.opacity="1",r.style.zIndex="3",r.className="eye modalOpen tShirtEye",r.dataset.product="welcome";let h=s.offsetHeight-25;s.style.top=`${h}px`,i.style.transform="",i.style.top="",i.style.left="",i.style.zIndex=""}else if(l<2.8*p){let g=(2.8*p-l)*2/p;r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product="",i.style.transform=`scale(${1+3.2*(1-g)}) rotate(${39*(1-g)-46*g}deg)`,i.style.top=`${boxBadgeStartOffsetTop*g+(o.offsetHeight-i.offsetHeight)/2*(1-g)}px`,i.style.left=`${boxBadgeStartOffsetLeft*g+(o.offsetWidth-i.offsetWidth)/2*(1-g)}px`,i.style.zIndex="2"}else if(l<3.8*p)r.style.opacity="1",r.style.zIndex="3",r.className="eye modalOpen boxBadgeEye",r.dataset.product="id",i.style.transform="scale(4.2) rotate(39deg)",i.style.top=`${(o.offsetHeight-i.offsetHeight)/2}px`,i.style.left=`${(o.offsetWidth-i.offsetWidth)/2}px`,i.style.zIndex="2";else if(l<4.3*p){r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product="";let E=(4.3*p-l)*2/p;i.style.transform=`scale(${1+3.2*E}) rotate(${39*E-46*(1-E)}deg)`,i.style.top=`${boxBadgeStartOffsetTop*(1-E)+(o.offsetHeight-i.offsetHeight)/2*E}px`,i.style.left=`${boxBadgeStartOffsetLeft*(1-E)+(o.offsetWidth-i.offsetWidth)/2*E}px`,i.style.zIndex="2"}else if(e<animationScreenEnd.boxScreen){r.style.opacity="0",r.style.zIndex="-1",r.className="eye modalOpen",r.dataset.product="",i.style.transform="",i.style.top="",i.style.left="",i.style.zIndex="";let S=(l-4.3*p)/p,$=s.offsetHeight-25,x=$-$*S;s.style.top=`${x}px`}else r.style.opacity="0",r.style.zIndex="-1",s.style.top="0px",o.style.opacity="0",dispatchAnimationEnd("laptopScreen",!1,500)},animateLaptopScreen=({currentY:e,deltaY:t})=>{let l=e-animationScreenEnd.boxScreen,n=document.querySelector("#laptopScreen .content"),a=document.querySelector("#footer .content"),o=n.parentElement||n.parentNode,s=document.querySelector("#laptopScreen .eye"),i=a.offsetHeight*scale;if(animationScreenEnd.laptopScreen=animationScreenEnd.boxScreen+i,t<0&&e<=animationScreenEnd.boxScreen){s.style.opacity="0",laptopTextInterval.length&&(laptopTextInterval.forEach(clearInterval),laptopTextInterval=[]);let r=document.getElementById("laptopText");r.innerText="",dispatchAnimationEnd("boxScreen",!0)}else e<=animationScreenEnd.laptopScreen?o.style.top=`-${l}px`:(o.style.top=`-${i}px`,animationNextStop=!0)},animate=({detail:e={}})=>{switch(currentScreen){case"firstScreen":animateFirstScreen(e);break;case"secondScreen":animateSecondScreen(e);break;case"cupScreen":animateCupScreen(e);break;case"bottleScreen":animateBottleScreen(e);break;case"boxScreen":animateBoxScreen(e);break;case"laptopScreen":animateLaptopScreen(e)}},rollbackAnimation=()=>{let e={currentY:0,deltaY:-1};animateFirstScreen(e),animateSecondScreen(e),animateCupScreen(e),animateBottleScreen(e),animateBoxScreen(e),animateLaptopScreen(e)},defaultActivateScreen=(e,t,l)=>{let n=document.getElementById("footer");if(n.style.zIndex="-1",animationNextStop=!0,t){let a=document.getElementById(e),o=a.nextElementSibling;if(o){if(!l){let s=e=>{e.target===o&&(a.style.zIndex="2",o.style.zIndex="",animationNextStop=!1,o.removeEventListener("transitionend",s))};o.addEventListener("transitionend",s)}o.style.top="100%"}}else{let i=document.getElementById(e);if(i){l||i.addEventListener("transitionend",e=>{e.target===i&&(animationNextStop=!1)});let r=i.previousElementSibling;r.classList.contains("contentWrapper")&&(r.style.zIndex="1"),i.style.top="0",i.style.opacity="1",i.style.zIndex="2"}}},activateLaptopScreen=()=>{let e=document.getElementById("laptopScreen"),t=document.getElementById("footer"),l=document.querySelector("#laptopScreen .eye"),n=document.getElementById("laptopText"),a=n.dataset.text;e.style.zIndex="3",t.style.zIndex="2",t.style.opacity="1",l.style.opacity="0";let o=0,s=e=>{n.innerText=a.substring(0,e)};laptopTextInterval.push(setInterval(()=>{s(o),o>=a.length&&(laptopTextInterval.forEach(clearInterval),laptopTextInterval=[],l.style.opacity="1",e.style.animation="1s linear 0s prevFooter",animationNextStop=!1),o+=1},100))},changeCurrentScreen=e=>{let{nextScreen:t,prev:l,delay:n,callback:a}=e.detail;n&&(animationStop=!0),setTimeout(()=>{switch(animationStop=!1,t){case"firstScreen":defaultActivateScreen(t,l),animationNextStop=!1;break;case"secondScreen":case"cupScreen":case"bottleScreen":case"boxScreen":defaultActivateScreen(t,l);break;case"laptopScreen":defaultActivateScreen(t,l,!0),activateLaptopScreen()}currentScreen=t,a&&a()},n)},moveTo=e=>{let t=new CustomEvent("moveTo",{detail:{moveTo:e}});window.dispatchEvent(t)},getStopPseudoScroll=e=>!!animationStop||(e<0&&(animationNextStop=!1),animationNextStop),startMainFlow=()=>{let e=document.getElementById("preloader"),t=document.querySelector("#preloader .content"),l=t.parentElement||t.parentNode,n=document.getElementById("preloaderRound"),a=document.getElementById("preloaderButton"),o=Math.max(l.offsetHeight,l.offsetWidth),s=o/scale*2;if(dispatchAnimationEnd("firstScreen",!1),n.style.height=`${s}px`,n.style.width=`${s}px`,a.style.display="none",e.style.opacity="0",e.addEventListener("transitionend",()=>{e.classList.remove("open")}),window.localStorage.hintClosed)setTimeout(()=>{for(let e of document.querySelectorAll("#firstScreen .eye"))e.classList.add("active")},1e3);else{animationStop=!0;let i=document.getElementById("modalHint");zIndex+=1,i.style.zIndex=zIndex.toString(),i.classList.add("open")}};let videoStarted=!1;const preloaderActivate=({target:e})=>{if(!videoStarted){videoStarted=!0;let{duration:t}=e,l=document.querySelector("#preloader .content"),n=l.parentElement||l.parentNode,a=document.getElementById("preloaderText"),o=l.offsetWidth*scale,s=Math.floor((n.offsetWidth-o)/2/scale);a.style.left=`calc(100% + ${s}px)`,a.style.transition=`left ${t}s`,a.style.left=`-${a.offsetWidth+s}px`,a.style.opacity="1"}},preloaderVideoEnd=()=>{let e=document.getElementById("preloader"),t=document.getElementById("preloaderButton");t.addEventListener("click",startMainFlow),e.classList.add("videoEnd")},videoSample=e=>{e.target.currentTime>2&&(e.target.currentTime=0)},closeModal=e=>{let{target:t}=e,l=0;for(;!t.classList.contains("modalClose")&&l<10;)t=t.parentElement||t.parentNode,l+=1;let n=document.querySelectorAll(".modalOpen.hideOnClick"),{modal:a}=t.dataset,o=document.getElementById(a);for(let s of n)s.dataset.modal===a&&(s.style.opacity="");o&&(o.classList.remove("open"),o.classList.remove("inactiveVideoOrQuiz"),zIndex-=1,o.style.zIndex="",animationStop=!1)},closeFullVideoOrQuiz=(e=!0)=>{let t=document.getElementById("productBlock"),l=document.getElementById("modalProduct"),n=document.getElementById("backButton"),a=document.getElementById("playButton"),o=document.querySelector("#modalProduct video"),s=document.getElementById("infoBlock"),i=document.getElementById("quizBlock");a.style.display="",setTimeout(()=>{s.style.display="",i.style.display=""},200),setTimeout(()=>{t.style.height=""},1200),n.removeEventListener("click",closeFullVideoOrQuiz),n.addEventListener("click",closeModal),l.classList.remove("activeVideo"),l.classList.remove("activeQuiz"),e&&l.classList.add("inactiveVideoOrQuiz"),o&&o.addEventListener("timeupdate",videoSample)},playFullVideo=()=>{let e=document.getElementById("modalProduct"),t=document.getElementById("backButton"),l=document.getElementById("playButton"),n=document.querySelector("#modalProduct video");l.style.display="none",t.removeEventListener("click",closeModal),t.addEventListener("click",closeFullVideoOrQuiz),n.removeEventListener("timeupdate",videoSample),e.classList.remove("inactiveVideoOrQuiz"),e.classList.add("activeVideo")},fullScreenChange=e=>{let t=document.fullscreenElement;!t&&document.mozFullScreenElement?t=document.mozFullScreenElement:!t&&document.webkitFullscreenElement&&(t=document.webkitFullscreenElement);let l=document.querySelector("#modalProduct video");e.target===t?(l.removeEventListener("timeupdate",videoSample),e.target.classList.add("mobileHorizontal")):(l.addEventListener("timeupdate",videoSample),e.target.classList.remove("mobileHorizontal"))},fullScreenVideo=()=>{let e=document.querySelector("#modalProduct video");e.playsInline=void 0,e.removeEventListener("timeupdate",videoSample),e.requestFullscreen?e.requestFullscreen():e.webkitEnterFullscreen?e.webkitEnterFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},setQuizStep=e=>()=>{let t=document.getElementById("quizQuestion"),l=t.innerText-1;if(Number.isInteger(e))t.innerText=e+1;else{let n=document.getElementById("quizTitle");n.innerText="Оставьте свои контакты и имя";let a=document.getElementById("quizCounter");a.style.display="none"}let o=document.getElementById("question_"+l);o.classList.remove("active");let s=document.getElementById("question_"+e);s.classList.add("active")},submitQuiz=e=>{e.preventDefault();let t=document.getElementById("quiz"),l=new window.FormData(t),n=l.get("quizKey"),a=quizData[n],o=l.get("quizName"),s=Array.from(l.keys()).filter((e,t,l)=>l.indexOf(e)===t);a.forEach((e,t)=>{o+="\n"+e.question,s.forEach(e=>{e.includes("question_"+t)&&(o+="\n"+l.getAll(e).join("\n"))})});let i={_url:window.location.href,"your-name":l.get("name"),"your-phone":l.get("phone"),"your-email":l.get("mail"),"your-message":o};fetch("http://new.topline.gq/n8n/webhook/promo_orders",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(i)}).then(()=>{let e=document.getElementById("quizTitle");e.innerText="Уже видим Ваш запрос!";let l=document.querySelectorAll("#quizBlock .question.active");l.forEach(e=>{e.classList.remove("active")});let n=document.createElement("h2");n.className="message",n.innerText="Вернемся с расчетом бюджета и сроков в самое ближайшее время",t.append(n)})},checkAnswer=(e,t)=>()=>{let l=document.getElementById("quiz"),n=Array.from(new window.FormData(l).entries()),a=n.find(([t,l])=>t.includes("question_"+e)&&l);t.disabled=!a},checkContact=e=>()=>{let t=document.getElementById("quiz"),l=new window.FormData(t),n=l.get("phone"),a=n.length>=16,o=l.get("mail"),s=/[^@]+@[^@]+\.[^@.]+/.test(o);e.disabled=!(l.get("name")&&(a||s))},startQuiz=e=>()=>{let t=document.getElementById("modalProduct"),l=document.getElementById("productBlock"),n=document.getElementById("backButton"),a=document.getElementById("infoBlock"),o=document.getElementById("quizBlock"),s=document.getElementById("quiz");s.addEventListener("submit",e=>e.preventDefault()),s.innerHTML="";let i=quizData[e.quizKey],r=document.createElement("div");r.className="quizHeader";let c=document.createElement("h1");c.className="quizTitle",c.id="quizTitle",c.innerText=e.quizTitle,r.append(c);let d=document.createElement("div");d.className="quizCounter",d.id="quizCounter";let p=document.createElement("span");p.innerText="1",p.id="quizQuestion",d.append(p);let y=document.createElement("span");y.innerText=i.length.toString(),d.append(y),r.append(d),s.append(r);let f=document.createElement("input");f.name="quizKey",f.type="hidden",f.value=e.quizKey,s.append(f);let m=document.createElement("input");m.name="quizName",m.type="hidden",m.value=e.quizTitle,s.append(m),i.forEach((e,t)=>{let l=document.createElement("div");t?l.className="question":l.className="question active",l.id="question_"+t;let n=document.createElement("h2");n.innerText=e.question,l.append(n);let a=document.createElement("button");if("MULTI_CHOICE"===e.type){let o=document.createElement("i");o.innerText="(можно выбрать несколько вариантов)",n.append(o);let r=document.createElement("fieldset");e.choices.forEach(e=>{let l=document.createElement("label");l.className="checkbox";let n=document.createElement("input");n.type="checkbox",n.name="question_"+t+"_choice",n.value=e,n.addEventListener("change",checkAnswer(t,a)),l.append(n);let o=document.createElement("span");o.innerText=e,l.append(o),r.append(l)}),l.append(r)}if("CHOICE"===e.type){let c=document.createElement("fieldset");e.choices.forEach(e=>{let l=document.createElement("label");l.className="radio";let n=document.createElement("input");n.type="radio",n.name="question_"+t+"_choice",n.value=e,n.addEventListener("change",checkAnswer(t,a)),l.append(n);let o=document.createElement("span");o.innerText=e,l.append(o),c.append(l)}),l.append(c)}if("INPUT"===e.type){let d=document.createElement("textarea");d.name="question_"+t+"_text",d.placeholder=e.placeholder,d.addEventListener("input",checkAnswer(t,a)),l.append(d)}if(e.other){let p=document.createElement("textarea");p.name="question_"+t+"_text",p.placeholder=e.other,p.addEventListener("input",checkAnswer(t,a)),l.append(p)}let y=document.createElement("div");if(y.className="buttons",t){let f=document.createElement("button");f.className="button border blue",f.innerHTML="<span>Назад</span>",f.addEventListener("click",setQuizStep(t-1)),y.append(f)}a.className="button blue",a.disabled=!0,t<i.length-1?(a.innerHTML="<span>Дальше</span>",a.addEventListener("click",setQuizStep(t+1))):(a.innerHTML="<span>Оформить</span>",a.addEventListener("click",setQuizStep("contact"))),y.append(a),l.append(y),s.append(l)});{let u=document.createElement("button"),h=document.createElement("div");h.className="question",h.id="question_contact";let g=document.createElement("input");g.name="name",g.placeholder="Имя",g.addEventListener("input",checkContact(u)),h.append(g);let E=document.createElement("input");E.type="phone",E.name="phone",E.placeholder="+7 (",IMask(E,{mask:"+{7}(000)000-00-00"}),E.addEventListener("input",checkContact(u)),h.append(E);let S=document.createElement("input");S.name="mail",S.placeholder="test@test.com",S.addEventListener("input",checkContact(u)),h.append(S),u.className="submit button blue",u.innerHTML="<span>Отправить</span>",u.disabled=!0,u.addEventListener("click",submitQuiz),h.append(u),s.append(h)}l.style.height=`${l.offsetHeight}px`,n.removeEventListener("click",closeModal),n.addEventListener("click",closeFullVideoOrQuiz),setTimeout(()=>{t.classList.remove("inactiveVideoOrQuiz"),t.classList.add("activeQuiz")},10),setTimeout(()=>{a.style.display="none",o.style.display="flex"},1e3)},activateProduct=(e,t=!0)=>{let l=document.getElementById("modalProduct");l.classList.remove("activeVideo");let n=e.charAt(0).toUpperCase()+e.slice(1),a="product"+n,o="navigator"+n,s=document.getElementById(a),i=s.parentElement||s.parentNode;for(let r of i.children)r!==s&&r.classList.contains("active")&&r.classList.remove("active");s.classList.add("active");let c=document.getElementById(o),d=c.parentElement||c.parentNode;for(let p of d.children)p!==c&&p.classList.remove("active");c.classList.add("active"),d.scrollTo(c.offsetLeft-d.offsetWidth/2,0);let y=productsData[e],f=document.getElementById("productTitle");f.innerHTML=y.title;let m=document.getElementById("productText");m.innerHTML=y.text;let u=document.getElementById("productShortText");u.innerHTML=y.shortText;let h=document.getElementById("quizButton"),g=document.getElementById("mailButton"),E=document.getElementById("productVideo"),S=document.getElementById("playButton"),$=document.getElementById("playButtonMobile"),x=document.getElementById("downloadButton"),v=document.getElementById("downloadButtonMobile"),z=E.getElementsByTagName("video");for(;z.length;)z.item(0).remove();if("service"===y.type)h.style.display="none",g.style.display="flex",S.style.display="none",$.style.display="none",x.style.display="flex",v.style.display="flex",E.classList.add("empty"),E.style.height="",E.style.width="";else if("product"===y.type){g.style.display="none",h.style.display="flex",x.style.display="none",v.style.display="none",S.style.display="flex",$.style.display="flex",E.classList.remove("empty");let I=document.createElement("video");I.addEventListener("timeupdate",videoSample),I.requestFullscreen?I.addEventListener("fullscreenchange",fullScreenChange):I.mozRequestFullScreen?I.addEventListener("mozfullscreenchange",fullScreenChange):I.webkitRequestFullScreen&&I.addEventListener("webkitfullscreenchange",fullScreenChange),I.autoplay=!0,I.loop=!0,I.playsInline=!0;let _=document.createElement("source");_.src=y.video+".webm",_.type="video/webm",I.append(_);let B=document.createElement("source");B.src=y.video+".mp4",B.type="video/mp4",I.append(B),I.oncanplay=()=>{I.play()},E.insertBefore(I,E.firstChild),S.addEventListener("click",playFullVideo),$.addEventListener("click",fullScreenVideo),h.addEventListener("click",startQuiz(y))}};let zIndex=1e4;const addEvents=()=>{window.addEventListener("resize",resizeContent),window.addEventListener("pseudoScroll",animate),window.addEventListener("animationEnd",changeCurrentScreen);let e=document.querySelector("#preloader video");e.addEventListener("play",preloaderActivate),e.addEventListener("timeupdate",preloaderActivate),e.addEventListener("ended",preloaderVideoEnd);let t=document.getElementsByClassName("modalOpen"),l=document.getElementsByClassName("modalClose");for(let n of t){let{classList:a,dataset:o}=n,{modal:s}=o;a.contains("eye")?(n.addEventListener("transitionend",e=>{if("width"===e.propertyName){let{target:t}=e;if("1"===e.target.dataset.click){e.target.dataset.click="";let l=0;for(;!t.classList.contains("modalOpen")&&l<10;)t=t.parentElement||t.parentNode,l+=1;if(t===n){let{product:a}=o,i=document.getElementById(s);i.classList.add("open"),zIndex+=1,i.style.zIndex=zIndex.toString(),activateProduct(a,!1),t.style.top=t.dataset.top,t.style.left=t.dataset.left,t.style.height=t.dataset.height,t.style.width=t.dataset.width,t.style.fontSize=t.dataset.fontSize,t.style.transition=t.dataset.transition,t.style.zIndex=t.dataset.zIndex,animationStop=!0}}}}),n.addEventListener("click",e=>{let{target:t}=e,l=0;for(;!t.classList.contains("modalOpen")&&l<10;)t=t.parentElement||t.parentNode,l+=1;let n=t;for(l=0;!n.classList.contains("content")&&l<100;)n=n.parentElement||n.parentNode,l+=1;let a=Math.max(window.innerHeight,window.innerWidth),o=t.offsetHeight/t.offsetWidth,s,i;o>1?(i=15*a,s=15*a/o):(i=15*a*o,s=15*a);let r=i/t.offsetHeight;t.dataset.click="1",t.dataset.transition=t.style.transition,t.style.transition="font-size cubic-bezier(.4,0,1,.44) 1.5s, width cubic-bezier(.4,0,1,.44) 1.5s, height cubic-bezier(.4,0,1,.44) 1.5s, top cubic-bezier(.4,0,1,.44) 1.5s, left cubic-bezier(.4,0,1,.44) 1.5s",t.dataset.top=t.style.top,t.style.top="50%",t.dataset.left=t.style.left,t.style.left="50%",t.dataset.height=t.style.height,t.style.height=`${i}px`,t.dataset.width=t.style.width,t.style.width=`${s}px`,t.dataset.fontSize=t.style.fontSize,t.style.fontSize=`${10*r}px`,t.dataset.zIndex=t.style.zIndex,zIndex+=1,t.style.zIndex=zIndex})):n.addEventListener("click",e=>{let{target:t}=e,l=0;for(;!t.classList.contains("modalOpen")&&l<10;)t=t.parentElement||t.parentNode,l+=1;let n=document.getElementById(s),a=n.classList.contains("open");n.classList.add("open"),zIndex+=1,n.style.zIndex=zIndex.toString(),o.product&&activateProduct(o.product,a),t.classList.contains("hideOnClick")&&(t.style.opacity="0"),animationStop=!0})}for(let i of l)i.addEventListener("click",closeModal);let r=document.getElementsByClassName("changeProduct");for(let c of r){let{dataset:d}=c,{product:p}=d;c.addEventListener("click",()=>{activateProduct(p),animationStop=!0})}let y=document.getElementsByClassName("navButton"),f=document.getElementById("menuNavigator"),m=f.parentElement||f.parentNode,u=m.parentElement||m.parentNode;for(let h of y){let{type:g}=h.dataset,E=document.querySelector(`.menuHintContentWrapper.${g} .menuHintContent`),S=E.parentElement||E.parentNode;h.addEventListener("mouseover",()=>{let e=m.offsetWidth*scale,t=Math.floor((u.offsetWidth-e)/2),l=(m.offsetWidth-f.offsetWidth)*scale,n=t+l;for(let a of(n<E.offsetWidth&&(E.style.minWidth=`${t+l}px`,E.style.maxWidth=`${t+l}px`),S.style.transition="left 0.3s 0.2s",S.style.left=`calc(100% - ${n}px)`,y))a!==h&&(a.style.opacity="0.3")}),h.addEventListener("mouseout",()=>{for(let e of(E.style.minWidth="",E.style.maxWidth="",S.style.transition="left 0.3s",S.style.left="100%",y))e!==h&&(e.style.opacity="")})}},closeHint=()=>{animationStop=!1;let e=document.getElementById("modalHint");e.classList.remove("open"),zIndex-=1,e.style.zIndex="",setTimeout(()=>{for(let e of document.querySelectorAll("#firstScreen .eye"))e.classList.add("active")},1e3),window.localStorage.hintClosed=!0},setPreloaderVideo=()=>{let e=["iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,t=void 0!==window.safari,l=document.getElementById("preloader"),n=document.getElementById("preloaderVideo"),a;t||e?(a=preloaderVideos.hvc1.src,l.style.background="#FFFFFF",l.style.color="#7382EC"):a=n.canPlayType&&n.canPlayType(`${preloaderVideos.vp9.type}; codecs=${preloaderVideos.vp9.codec}`)?preloaderVideos.vp9.src:preloaderVideos.vp8.src,n.src=a,n.oncanplay=()=>{n.play()}};window.onload=()=>{animationStop=!0,registerPseudoScrollEvent(window,getStopPseudoScroll),resizeContent(),addEvents(),setPreloaderVideo()};